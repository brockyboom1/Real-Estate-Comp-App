<!DOCTYPE html>
<html>
<head>
    <title>Real Estate Agency Map</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            min-height: 100vh;
            background: #f5f7fa;
        }
        
        .header {
            background-color: #4c6ef5;
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
        }
        
        .header p {
            margin: 8px 0 0;
            font-size: 16px;
            opacity: 0.9;
        }

        .toggle-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            padding: 20px;
        }

        .toggle-btn {
            padding: 8px 16px;
            border: 1px solid #4c6ef5;
            border-radius: 20px;
            background: transparent;
            color: #4c6ef5;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .toggle-btn.active {
            background: #4c6ef5;
            color: white;
        }

        .toggle-btn:hover {
            background: rgba(76, 110, 245, 0.1);
        }

        #map {
            height: 75vh;
            width: 100%;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .agency-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            padding: 20px;
            max-width: 2200px;  /* Increased from 2000px */
            margin: 0 auto;
            position: relative;
            width: 110%;  /* Added to expand width */
            left: -5%;  /* Center the expanded width */
        }

        .agency-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.08);
            padding: 30px;
            transition: transform 0.2s;
            height: fit-content;
            min-width: 495px;
            position: relative;
        }

        .agency-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .agency-name {
            font-size: 26px;
            margin-bottom: 15px;
            text-align: center;
        }

        .agency-address {
            color: #555;
            font-size: 16px;
            margin-bottom: 12px;
            text-align: center;
        }

        .agency-phone {
            color: #4c6ef5;
            font-size: 16px;
            margin-bottom: 25px;
            text-align: center;
        }

        .agency-logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .agency-logo-image {
            max-width: 200px;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .agent-compare-toggle {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
        }

        .agent-compare-label {
            display: flex;
            align-items: center;
            background: white;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .agent-compare-label:hover {
            background: #f0f0f0;
        }

        .agent-compare-label input[type="checkbox"] {
            margin-right: 5px;
        }

        .agent-compare-label span {
            font-size: 12px;
            color: #333;
        }

        .staff-member {
            position: relative;
            /* ... existing staff-member styles ... */
        }

        .agency-compare-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1;
        }

        .agency-compare-label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-size: 14px;
            color: #4c6ef5;
            background: rgba(76, 110, 245, 0.1);
            padding: 6px 12px;
            border-radius: 20px;
            transition: all 0.2s ease;
        }

        .agency-compare-label:hover {
            background: rgba(76, 110, 245, 0.2);
        }

        .agency-compare-label input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .agency-compare-label.checked {
            background: #4c6ef5;
            color: white;
        }

        /* Agency Comparison Bar */
        #agencyCompareBar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .selected-agencies {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .selected-agency {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f0f4ff;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        .remove-agency {
            cursor: pointer;
            color: #666;
            font-size: 18px;
            line-height: 1;
        }

        .agency-compare-actions {
            display: flex;
            gap: 10px;
        }

        .agency-compare-button {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .agency-compare-button.primary {
            background: #4c6ef5;
            color: white;
        }

        .agency-compare-button.secondary {
            background: #f0f4ff;
            color: #4c6ef5;
        }

        .agency-compare-button:hover {
            opacity: 0.9;
        }

        /* Agency Comparison Modal */
        #agencyComparisonModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1100;
            overflow-y: auto;
        }

        .agency-comparison-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 1200px;
            position: relative;
        }

        .agency-comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .agency-comparison-card {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .agency-comparison-card img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 15px;
        }

        .agency-comparison-card h3 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .agency-comparison-card p {
            margin: 0;
            color: #666;
        }

        .agency-metric-comparison {
            display: grid;
            gap: 20px;
        }

        .agency-metric-row {
            display: grid;
            grid-template-columns: 200px repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .agency-metric-label {
            font-weight: bold;
            color: #333;
        }

        .agency-metric-value {
            text-align: center;
            padding: 8px;
            border-radius: 5px;
            background: white;
        }

        .agency-metric-value.price {
            color: #4c6ef5;
        }

        .agency-metric-value.days {
            color: #2f9e44;
        }

        .agency-metric-value.properties {
            color: #e03131;
        }

        .agency-name {
            font-size: 36px;  /* Increased font size */
            margin-bottom: 15px;
        }

        .agency-address, .agency-phone {
            font-size: 18px;  /* Increased font size */
            margin-bottom: 10px;
        }

        .agency-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .stat-item:hover {
            transform: translateY(-3px);
        }

        .stat-label {
            color: #555;
            font-size: 15px;
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            color: #4c6ef5;
            font-weight: bold;
            font-size: 28px;
        }

        .reviews-section {
            border-top: 1px solid #eee;
            padding-top: 15px;
            margin-top: 15px;
        }

        .rating-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .stars {
            color: #ffd700;
            font-size: 18px;
        }

        .review-count {
            color: #666;
            font-size: 14px;
        }

        .review-toggle {
            background: #f0f0f0;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .review-toggle:hover {
            background: #e0e0e0;
        }

        .reviews-list {
            font-size: 14px;
            color: #666;
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .reviews-list li {
            margin-bottom: 5px;
            padding: 5px;
            background: #f9f9f9;
            border-radius: 4px;
        }

        .good-review {
            border-left: 3px solid #4caf50;
        }

        .bad-review {
            border-left: 3px solid #f44336;
        }

        .map-container {
            position: relative;
            height: 400px;
        }

        .map-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1;
            display: flex;
            gap: 10px;
        }

        .map-button {
            background: white;
            border: 1px solid #ccc;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .map-button:hover {
            background: #f0f0f0;
        }

        .filter-container {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .suburb-select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            min-width: 200px;
            cursor: pointer;
        }

        .suburb-select:hover {
            border-color: #4c6ef5;
        }

        .suburb-select:focus {
            outline: none;
            border-color: #4c6ef5;
            box-shadow: 0 0 0 2px rgba(76,110,245,0.1);
        }

        .staff-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #eef1f5;
        }

        .staff-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .staff-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.2s;
        }

        .staff-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .staff-name {
            font-weight: bold;
            color: #4c6ef5;
        }

        .staff-position {
            font-size: 12px;
            color: #888;
            margin: 3px 0;
        }

        .staff-phone {
            color: #4c6ef5;
            font-size: 12px;
        }

        .modal-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .staff-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            z-index: 1001;
            max-height: 90vh;
            overflow-y: auto;
            width: 90%;
            max-width: 600px;
        }

        .staff-modal-content {
            padding: 30px;
            position: relative;
            max-height: calc(90vh - 60px);
            overflow-y: auto;
        }

        .staff-modal-header {
            position: sticky;
            top: 0;
            z-index: 1002;
            background: white;
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
        }

        .staff-modal-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #666;
            padding: 0.5rem;
            line-height: 1;
        }

        .staff-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
        }

        .staff-modal-photo {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            object-fit: cover;
        }

        .staff-photo-container {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto;
        }

        .staff-modal-photo-container {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto;
        }

        .staff-modal-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            margin-bottom: 0.75rem;
        }

        .staff-modal-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .staff-modal-position {
            font-size: 1.1rem;
            color: #4b5563;
            margin-bottom: 0.25rem;
        }

        .staff-modal-phone {
            font-size: 1rem;
            color: #6b7280;
            margin-bottom: 0.75rem;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            width: 100%;
            max-width: 350px;
            margin-top: 0.5rem;
        }

        .performance-item {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
        }

        .performance-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border-color: #4c6ef5;
        }

        .performance-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e40af;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .performance-label {
            font-size: 0.875rem;
            color: #475569;
            text-align: center;
            font-weight: 500;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .compare-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #4c6ef5;
            color: white;
            padding: 15px 25px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(76,110,245,0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            cursor: pointer;
            border: none;
            display: none !important;  /* Hide the compare button */
        }

        .compare-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(76,110,245,0.4);
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            position: relative;
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border: 1px solid #888;
            border-radius: 12px;
            width: 90%;
            max-width: 1540px;  /* Increased by 10% from 1400px */
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .modal-close:hover {
            color: #000;
        }

        .compare-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .agent-selector {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
        }

        .agent-selector h3 {
            margin-bottom: 1rem;
            color: #1f2937;
        }

        .agent-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .agent-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .agent-item:hover {
            background: #f3f4f6;
        }

        .agent-item.selected {
            background: #e5e7eb;
            border-color: #4c6ef5;
        }

        .agent-item img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 1rem;
            object-fit: cover;
        }

        .agent-info {
            flex: 1;
        }

        .agent-name {
            font-weight: 500;
            color: #1f2937;
        }

        .agent-details {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .comparison-stats {
            margin-top: 2rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 8px;
        }

        .comparison-stats h3 {
            margin-bottom: 1rem;
            color: #1f2937;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .stat-card {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .stat-title {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }

        .difference-indicator {
            display: flex;
            align-items: center;
            margin-top: 0.5rem;
            font-size: 0.875rem;
        }

        .difference-value {
            margin-left: 0.5rem;
            font-weight: 500;
        }

        .better {
            color: #059669;
        }

        .worse {
            color: #dc2626;
        }

        .better-performer {
            border: 2px solid #059669;
            background: #f0fdf4;
        }

        .search-container {
            margin-bottom: 1rem;
        }

        .search-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .search-input:focus {
            outline: none;
            border-color: #4c6ef5;
            box-shadow: 0 0 0 2px rgba(76, 110, 245, 0.1);
        }

        .no-results {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }

        /* Category Tabs */
        .category-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .category-tab {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .category-tab.active {
            background: #4c6ef5;
            color: white;
            border-color: #4c6ef5;
        }

        .category-tab:hover {
            background: #f3f4f6;
        }

        .category-tab.active:hover {
            background: #3b82f6;
        }

        /* Filter Buttons */
        .filter-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .filter-button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-button:hover {
            background: #f3f4f6;
        }

        .filter-button.active {
            background: #4c6ef5;
            color: white;
            border-color: #4c6ef5;
        }

        .filter-button.active:hover {
            background: #3b82f6;
        }

        .sort-icon {
            font-size: 0.875rem;
        }

        .sort-icon.asc {
            transform: rotate(180deg);
        }

        /* Ranked List Styles */
        .ranked-list {
            margin-top: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .ranked-list-header {
            padding: 1rem;
            background: #f8f9fa;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ranked-list-title {
            font-weight: 600;
            color: #1f2937;
        }

        .ranked-list-content {
            max-height: 400px;
            overflow-y: auto;
        }

        .ranked-item {
            display: grid;
            grid-template-columns: 40px 1fr 1fr 1fr 1fr;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            align-items: center;
        }

        .ranked-item:last-child {
            border-bottom: none;
        }

        .rank-number {
            font-weight: 600;
            color: #4c6ef5;
            text-align: center;
        }

        .rank-agent-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .rank-agent-photo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .rank-agent-details {
            display: flex;
            flex-direction: column;
        }

        .rank-agent-name {
            font-weight: 500;
            color: #1f2937;
        }

        .rank-agent-position {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .rank-value {
            font-weight: 600;
            color: #1f2937;
        }

        .rank-value.better {
            color: #059669;
        }

        .rank-value.worse {
            color: #dc2626;
        }

        .staff-category-btn {
            padding: 8px 16px;
            border: 2px solid #4c6ef5;
            border-radius: 20px;
            background: white;
            color: #4c6ef5;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .staff-category-btn:hover {
            background: #4c6ef5;
            color: white;
        }

        .staff-category-btn.active {
            background: #4c6ef5;
            color: white;
        }

        .staff-grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .staff-member {
            display: block;
        }

        .staff-member.hidden {
            display: none;
        }

        .comparison-difference {
            color: #28a745;
            font-weight: bold;
            margin-left: 8px;
        }

        .comparison-arrow {
            font-size: 18px;
            font-weight: bold;
        }

        .container {
            width: 110%;  /* Added to expand container */
            margin-left: -5%;  /* Center the expanded width */
            position: relative;
            overflow-x: hidden;  /* Prevent horizontal scrolling */
        }

        .agency-details {
            padding: 40px;  /* Increased padding */
            background: linear-gradient(to bottom, #f8f9fa, white);
        }

        .agency-name {
            font-size: 36px;  /* Increased font size */
            margin-bottom: 15px;
        }

        .agency-address, .agency-phone {
            font-size: 18px;  /* Increased font size */
            margin-bottom: 10px;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;  /* Increased gap */
            padding: 30px;  /* Increased padding */
            background: #f8f9fa;
        }

        .performance-metric {
            text-align: center;
            padding: 25px;  /* Increased padding */
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .metric-value {
            font-size: 32px;  /* Increased font size */
            font-weight: bold;
            color: #006B3F;
            margin-bottom: 10px;
        }

        .metric-label {
            font-size: 16px;  /* Increased font size */
            color: #666;
        }

        .rank-toggle-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            padding: 15px 25px;
            background: #006B3F;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
        }

        .rank-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
            background: #008B4F;
        }

        .rank-toggle-btn i {
            font-size: 20px;
        }

        .rankings-controls {
            margin-bottom: 30px;
        }

        .metric-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .metric-button {
            padding: 10px 20px;
            border: 2px solid #4c6ef5;
            background: white;
            color: #4c6ef5;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .metric-button:hover {
            background: rgba(76, 110, 245, 0.1);
        }

        .metric-button.active {
            background: #4c6ef5;
            color: white;
        }

        .rankings-list {
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 15px;
        }

        .rankings-list::-webkit-scrollbar {
            width: 8px;
        }

        .rankings-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .rankings-list::-webkit-scrollbar-thumb {
            background: #4c6ef5;
            border-radius: 4px;
        }

        .rankings-list::-webkit-scrollbar-thumb:hover {
            background: #3b5bd4;
        }

        .agent-profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .agent-profile-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .agent-profile-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 3px solid #006B3F;
        }

        .agent-profile-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .agent-profile-agency {
            color: #666;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .agent-profile-stats {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 8px;
            width: 100%;
        }

        .agent-profile-stat {
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .stat-value {
            font-weight: bold;
            color: #006B3F;
        }

        .agent-profile {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
        }

        .agent-profile-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #f0f0f0;
        }

        .agent-profile-info {
            flex: 1;
        }

        .agent-profile-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .agent-profile-name {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .agent-profile-position {
            font-size: 16px;
            color: #666;
            margin: 5px 0;
        }

        .agent-profile-contact {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .agent-profile-contact i {
            color: #666;
        }

        .agent-profile-contact span {
            color: #333;
            font-size: 14px;
        }

        .agent-profile-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .metric-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .metric-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }

        .metric-value {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .metric-value span {
            font-size: 14px;
            color: #666;
        }

        .agent-profile-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-button {
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-button.primary {
            background: #007bff;
            color: white;
            border: none;
        }

        .action-button.secondary {
            background: white;
            color: #007bff;
            border: 1px solid #007bff;
        }

        .action-button:hover {
            opacity: 0.9;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .metric-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
        }

        .metric-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .metric-value.price {
            color: #28a745;
        }

        .metric-value.days {
            color: #007bff;
        }

        .metric-value.properties {
            color: #6c757d;
        }

        .metric-unit {
            font-size: 14px;
            color: #666;
            margin-left: 2px;
        }

        .compare-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1;
        }

        .compare-label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-size: 14px;
            color: #4c6ef5;
        }

        .compare-label input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        #compareBar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .selected-agents {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .selected-agent {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f0f4ff;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        .selected-agent img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }

        .remove-agent {
            cursor: pointer;
            color: #666;
            font-size: 18px;
            line-height: 1;
        }

        .compare-actions {
            display: flex;
            gap: 10px;
        }

        .compare-button {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .compare-button.primary {
            background: #4c6ef5;
            color: white;
        }

        .compare-button.secondary {
            background: #f0f4ff;
            color: #4c6ef5;
        }

        .compare-button:hover {
            opacity: 0.9;
        }

        #comparisonModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1100;
            overflow-y: auto;
        }

        .comparison-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 1200px;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .agent-comparison {
            text-align: center;
        }

        .agent-comparison img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-bottom: 15px;
        }

        .agent-comparison h3 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .agent-comparison p {
            margin: 0;
            color: #666;
        }

        .metric-comparison {
            display: grid;
            gap: 20px;
        }

        .metric-row {
            display: grid;
            grid-template-columns: 200px repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .metric-label {
            font-weight: bold;
            color: #333;
        }

        .metric-value {
            text-align: center;
            padding: 8px;
            border-radius: 5px;
            background: white;
        }

        .metric-value.price {
            color: #4c6ef5;
        }

        .metric-value.days {
            color: #2f9e44;
        }

        .metric-value.properties {
            color: #e03131;
        }

        .agency-name {
            font-size: 36px;  /* Increased font size */
            margin-bottom: 15px;
        }

        .agency-address, .agency-phone {
            font-size: 18px;  /* Increased font size */
            margin-bottom: 10px;
        }

        .comparison-section {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .comparison-filters {
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-button {
            padding: 8px 16px;
            border: 1px solid #4c6ef5;
            border-radius: 20px;
            background: transparent;
            color: #4c6ef5;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .filter-button:hover {
            background: rgba(76, 110, 245, 0.1);
        }

        .filter-button.active {
            background: #4c6ef5;
            color: white;
        }

        .sort-icon {
            font-size: 12px;
        }

        .sort-icon.asc {
            transform: rotate(180deg);
        }

        .comparison-table {
            overflow-x: auto;
            margin-top: 20px;
        }

        .comparison-table table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .comparison-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .comparison-table tr:last-child td {
            border-bottom: none;
        }

        .agent-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .agent-cell img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .agent-name {
            font-weight: 500;
            color: #333;
        }

        .agent-position {
            font-size: 12px;
            color: #666;
        }

        .price {
            color: #4c6ef5;
            font-weight: 500;
        }

        .days {
            color: #2f9e44;
            font-weight: 500;
        }

        .properties {
            color: #e03131;
            font-weight: 500;
        }

        .comparison-table tr:hover {
            background: #f8f9fa;
        }

        .agency-logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .agency-logo-image {
            max-width: 200px;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .agency-card {
            position: relative;
            /* ... existing agency-card styles ... */
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPGzKsZchYfWG7uYpa3ZYJgUCYS0c9_fU"></script>
</head>
<body>
    <!-- Add this right after the body tag -->
    <button onclick="showAgentRankings()" class="rank-toggle-btn">
        <i class="fas fa-trophy"></i>
        View Agent Rankings
    </button>

    <!-- Add Font Awesome for the trophy icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <div class="header">
        <h1>Melbourne Real Estate Agencies</h1>
        <p>Comprehensive rental market data and agent information</p>
    </div>

    <!-- Remove the button element -->
    <button class="compare-button" onclick="openCompareModal(); return false;" style="display: none;">Compare Agents</button>

    <div style="position: relative;">
        <div class="filter-container">
            <select class="suburb-select" id="suburb-filter" onchange="filterAgencies()">
                <option value="all">All Suburbs</option>
                <option value="South Yarra">South Yarra</option>
                <option value="Melbourne">Melbourne</option>
                <option value="Toorak">Toorak</option>
            </select>
        </div>
        <div id="map"></div>
        <div class="container">
            <div class="agency-cards" id="agency-list"></div>
                        </div>
                    </div>

    <div class="modal-backdrop" id="modal-backdrop"></div>
    <div class="staff-modal" id="staff-modal"></div>

    <!-- Comparison Bar -->
    <div id="compareBar">
        <div class="selected-agents"></div>
        <div class="compare-actions">
            <button class="compare-button primary" onclick="showComparison()">Compare Selected</button>
            <button class="compare-button secondary" onclick="clearComparison()">Clear All</button>
            </div>
            </div>

    <!-- Comparison Modal -->
    <div id="comparisonModal">
        <div class="comparison-content">
            <span class="close-modal" onclick="hideComparisonModal()">&times;</span>
            <h2>Agent Comparison</h2>
            <div class="comparison-grid"></div>
            <div class="metric-comparison"></div>
                    </div>
                </div>

    <!-- Agency Comparison Bar -->
    <div id="agencyCompareBar">
        <div class="selected-agencies"></div>
        <div class="agency-compare-actions">
            <button class="agency-compare-button primary" onclick="showAgencyComparison()">Compare Selected</button>
            <button class="agency-compare-button secondary" onclick="clearAgencyComparison()">Clear All</button>
                </div>
            </div>

    <!-- Agency Comparison Modal -->
    <div id="agencyComparisonModal">
        <div class="agency-comparison-content">
            <span class="close-modal" onclick="hideAgencyComparisonModal()">&times;</span>
            <h2>Agency Comparison</h2>
            <div class="agency-comparison-grid"></div>
            <div class="agency-metric-comparison"></div>
        </div>
    </div>

    <script>
        let map;
        let markers = [];
        let currentInfoWindow = null;
        let allAgencies = [];
        let currentCategory = 'sales';

        function getStarRating(rating) {
            const fullStar = '★';
            const emptyStar = '☆';
            const stars = Math.round(rating);
            return fullStar.repeat(stars) + emptyStar.repeat(5 - stars);
        }

        function getSuburbFromAddress(address) {
            // Handle South Yarra addresses specifically
            if (address.toLowerCase().includes('south yarra')) {
                return 'South Yarra';
            }
            
            const parts = address.split(',');
            for (let part of parts) {
                part = part.trim();
                if (part.includes('VIC')) {
                    return part.split('VIC')[0].trim();
                }
            }
            return '';
        }

        function initMap() {
            // Center point between Melbourne CBD and Toorak (weighted average of all locations)
            const center = { lat: -37.825, lng: 144.985 };
            
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 13,  // Adjusted zoom level to show all locations clearly
                center: center,
                mapTypeControl: true,
                mapTypeControlOptions: {
                    position: google.maps.ControlPosition.TOP_RIGHT
                },
                streetViewControl: true,
                streetViewControlOptions: {
                    position: google.maps.ControlPosition.RIGHT_BOTTOM
                },
                fullscreenControl: true,
                fullscreenControlOptions: {
                    position: google.maps.ControlPosition.RIGHT_TOP
                },
                zoomControl: true,
                zoomControlOptions: {
                    position: google.maps.ControlPosition.RIGHT_CENTER
                }
            });

            loadAgencies();
        }

        function loadAgencies() {
            fetch('/api/agencies')
                .then(response => response.json())
                .then(agencies => {
                    allAgencies = agencies; // Store all agencies
                    displayAgencies(agencies);
                })
                .catch(error => {
                    console.error('Error loading agencies:', error);
                });
        }

        function filterAgencies() {
            const selectedSuburb = document.getElementById('suburb-filter').value;
            
            // Clear existing markers
            markers.forEach(marker => marker.setMap(null));
            markers = [];

            // Filter agencies
            const filteredAgencies = selectedSuburb === 'all' 
                ? allAgencies 
                : allAgencies.filter(agency => getSuburbFromAddress(agency.address) === selectedSuburb);

            // Update map bounds
            if (filteredAgencies.length > 0) {
                const bounds = new google.maps.LatLngBounds();
                filteredAgencies.forEach(agency => {
                    bounds.extend({ lat: agency.lat, lng: agency.lng });
                });
                map.fitBounds(bounds);
                
                // If only one agency, zoom in closer
                if (filteredAgencies.length === 1) {
                    map.setZoom(16);
                }
            }

            // Display filtered agencies
            displayAgencies(filteredAgencies);
        }

        function displayAgencies(agencies) {
            const agencyList = document.getElementById('agency-list');
            agencyList.innerHTML = '';

            // Create bounds object to fit all markers
            const bounds = new google.maps.LatLngBounds();

            agencies.forEach(agency => {
                // Create marker with custom styling
                const position = { lat: agency.lat, lng: agency.lng };
                const marker = new google.maps.Marker({
                    position: position,
                    map: map,
                    title: agency.name,
                    animation: google.maps.Animation.DROP,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 10,
                        fillColor: '#4c6ef5',
                        fillOpacity: 1,
                        strokeColor: '#ffffff',
                        strokeWeight: 2
                    }
                });
                
                // Extend bounds to include this marker
                bounds.extend(position);
                markers.push(marker);

                // Create info window content
                const infoContent = `
                    <div style="padding: 40px; max-width: ${agency.name === 'Woodards' ? '90vw' : '600px'}; width: ${agency.name === 'Woodards' ? '90vw' : '600px'}; max-height: 90vh; background: white; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); overflow: visible;">
                        <div style="display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 480px; margin: 0 auto;">
                            ${agency.name === 'Belle Property' ? `
                                <div style="display: flex; flex-direction: column; align-items: center; width: 100%; position: relative; text-align: center;">
                                    <button onclick="toggleCompareMode(this)" 
                                            class="staff-category-btn" 
                                            data-category="compare"
                                            style="position: absolute; left: 20px; top: -20px; white-space: nowrap; padding: 8px 16px; border: 2px solid #4c6ef5; background: white; color: #4c6ef5; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.3s ease; z-index: 10;">
                                        Compare Agents
                                    </button>
                                    <img src="/images/agents/Suburbs/South Yarra - 3141/Belle Property/belle property logo.png" 
                                         alt="Belle Property Logo" 
                                         style="height: 160px; width: auto; margin-bottom: 20px;">
                                    <div style="text-align: center; margin-top: -30px; width: 100%;">
                                        <h2 style="margin: 0 0 10px 0; color: #4c6ef5; font-size: 24px;">${agency.name}</h2>
                                        <p style="margin: 0 0 10px 0; color: #666; font-size: 16px;">${agency.address}</p>
                                        ${agency.phone ? `<p style="margin: 0 0 20px 0; color: #4c6ef5; font-size: 16px;">${agency.phone}</p>` : ''}
                                        <h3 style="margin: 0 0 20px 0; color: #333; font-size: 18px; font-weight: 600;">Market Performance Snapshot</h3>
                        </div>
                                </div>
                            ` : `
                                <h2 style="margin: 0 0 10px 0; color: #4c6ef5; font-size: 24px;">${agency.name}</h2>
                            `}
                            
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 0 0 20px 0;">
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center;">
                                    <div style="font-size: 16px; color: #666; margin-bottom: 10px;">Median Lease</div>
                                    <div style="font-size: 24px; font-weight: bold; color: #4c6ef5;">$${agency.medianLeasePrice}</div>
                            </div>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center;">
                                    <div style="font-size: 16px; color: #666; margin-bottom: 10px;">Days Listed</div>
                                    <div style="font-size: 24px; font-weight: bold; color: #4c6ef5;">${agency.medianDaysAdvertised}</div>
                            </div>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center;">
                                    <div style="font-size: 16px; color: #666; margin-bottom: 10px;">Properties Leased</div>
                                    <div style="font-size: 24px; font-weight: bold; color: #4c6ef5;">${agency.propertiesLeased}</div>
                            </div>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center;">
                                    <div style="font-size: 16px; color: #666; margin-bottom: 10px;">Available Now</div>
                                    <div style="font-size: 24px; font-weight: bold; color: #4c6ef5;">${agency.propertiesForRent}</div>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 0;">
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center;">
                                    <div style="font-size: 16px; color: #666; margin-bottom: 10px;">Median Sold Price</div>
                                    <div style="font-size: 24px; font-weight: bold; color: #4c6ef5;">$615k</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center;">
                                    <div style="font-size: 16px; color: #666; margin-bottom: 10px;">Median Days Advertised</div>
                                    <div style="font-size: 24px; font-weight: bold; color: #4c6ef5;">36</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center;">
                                    <div style="font-size: 16px; color: #666; margin-bottom: 10px;">Properties Sold</div>
                                    <div style="font-size: 24px; font-weight: bold; color: #4c6ef5;">172</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center;">
                                    <div style="font-size: 16px; color: #666; margin-bottom: 10px;">Properties For Sale</div>
                                    <div style="font-size: 24px; font-weight: bold; color: #4c6ef5;">25</div>
                            </div>
                        </div>

                        ${agency.staff ? `
                            <div style="margin-top: 25px; border-top: 1px solid #eee; padding-top: 25px; text-align: center;">
                                <h3 style="margin: 0 0 20px 0; color: #333; font-size: 20px; text-align: center;">Our Team</h3>
                                
                                <div style="display: flex; gap: 8px; margin-bottom: 20px; justify-content: center; flex-wrap: wrap;">
                                    <button onclick="toggleStaffCategory(this, 'all', '${agency.name}')" 
                                            class="staff-category-btn active" 
                                            data-category="all"
                                            style="white-space: nowrap; padding: 8px 16px; border: 2px solid #4c6ef5; background: #4c6ef5; color: white; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.3s ease;">
                                        All Staff
                                    </button>
                                    <button onclick="toggleStaffCategory(this, 'sales', '${agency.name}')" 
                                            class="staff-category-btn" 
                                            data-category="sales"
                                            style="white-space: nowrap; padding: 8px 16px; border: 2px solid #4c6ef5; background: white; color: #4c6ef5; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.3s ease;">
                                        Sales Agents
                                    </button>
                                    <button onclick="toggleStaffCategory(this, 'property', '${agency.name}')" 
                                            class="staff-category-btn" 
                                            data-category="property"
                                            style="white-space: nowrap; padding: 8px 16px; border: 2px solid #4c6ef5; background: white; color: #4c6ef5; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.3s ease;">
                                        Property Managers
                                    </button>
                                    <button onclick="toggleStaffCategory(this, 'bdm', '${agency.name}')" 
                                            class="staff-category-btn" 
                                            data-category="bdm"
                                            style="white-space: nowrap; padding: 8px 16px; border: 2px solid #4c6ef5; background: white; color: #4c6ef5; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.3s ease;">
                                        Business Development Managers
                                    </button>
                                    <button onclick="toggleStaffCategory(this, 'leasing', '${agency.name}')" 
                                            class="staff-category-btn" 
                                            data-category="leasing"
                                            style="white-space: nowrap; padding: 8px 16px; border: 2px solid #4c6ef5; background: white; color: #4c6ef5; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.3s ease;">
                                        Leasing Consultants
                                    </button>
                                </div>

                                <div class="staff-category active" data-category="all" style="margin-top: 20px;">
                                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px;">
                                ${agency.staff.map(member => `
                                            <div class="staff-member" 
                                                 onclick="showStaffModal(${JSON.stringify(member).replace(/"/g, '&quot;')})"
                                                 style="display: flex; flex-direction: column; align-items: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                                                <div class="staff-photo-container">
                                                    <img src="${member.photo}" alt="${member.name}" class="staff-photo">
                                                </div>
                                                <div style="text-align: center;">
                                                    <h4 style="margin: 0 0 5px 0; color: #333;">${member.name}</h4>
                                                    <p style="margin: 0 0 5px 0; color: #666; font-size: 14px;">${member.position}</p>
                                                    <p style="margin: 0 0 15px 0; color: #4c6ef5; font-size: 14px;">${member.phone}</p>
                                                    
                                                    ${member.performance ? `
                                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%;">
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">$${member.performance.medianSoldPrice}k</div>
                                                            <div style="font-size: 12px; color: #666;">Median sold price</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">${member.performance.medianDaysAdvertised}</div>
                                                            <div style="font-size: 12px; color: #666;">Median days advertised</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">${member.performance.propertiesSoldLead}</div>
                                                            <div style="font-size: 12px; color: #666;">Properties sold (as lead)</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">${member.performance.propertiesSoldSecondary}</div>
                                                            <div style="font-size: 12px; color: #666;">Properties sold (as secondary)</div>
                                                        </div>
                                                    </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        `).join('')}
                                        ${agency.name === 'Belle Property' ? `
                                            <div class="staff-member" 
                                                 onclick="showStaffModal(${JSON.stringify({
                                                    name: "Anthony Benic",
                                                    position: "Sales Associate",
                                                    phone: "0466 474 536",
                                                    photo: "/images/agents/Suburbs/South Yarra - 3141/Belle Property/anthony benic.jpg",
                                                    performance: {
                                                        medianSoldPrice: "445k",
                                                        medianDaysAdvertised: 42,
                                                        propertiesSoldLead: 35,
                                                        propertiesSoldSecondary: 14
                                                    }
                                                }).replace(/"/g, '&quot;')})"
                                                 style="display: flex; flex-direction: column; align-items: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                                                <div class="staff-photo-container">
                                                    <img src="/images/agents/Suburbs/South Yarra - 3141/Belle Property/anthony benic.jpg" alt="Anthony Benic" class="staff-photo">
                                        </div>
                                        <div style="text-align: center;">
                                                    <h4 style="margin: 0 0 5px 0; color: #333;">Anthony Benic</h4>
                                                    <p style="margin: 0 0 5px 0; color: #666; font-size: 14px;">Sales Associate</p>
                                                    <p style="margin: 0 0 15px 0; color: #4c6ef5; font-size: 14px;">0466 474 536</p>
                                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%;">
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">$445k</div>
                                                            <div style="font-size: 12px; color: #666;">Median sold price</div>
                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">42</div>
                                                            <div style="font-size: 12px; color: #666;">Median days advertised</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">35</div>
                                                            <div style="font-size: 12px; color: #666;">Properties sold (as lead)</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">14</div>
                                                            <div style="font-size: 12px; color: #666;">Properties sold (as secondary)</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>

                                <div class="staff-category" data-category="sales" style="display: none; margin-top: 20px;">
                                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px;">
                                        ${agency.staff.filter(member => 
                                            member.position.toLowerCase().includes('sales') || 
                                            member.position.toLowerCase().includes('principal') ||
                                            member.position.toLowerCase().includes('director')
                                        ).map(member => `
                                            <div class="staff-member" 
                                                 onclick="showStaffModal(${JSON.stringify(member).replace(/"/g, '&quot;')})"
                                                 style="display: flex; flex-direction: column; align-items: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                                                <div class="staff-photo-container">
                                                    <img src="${member.photo}" alt="${member.name}" class="staff-photo">
                                                </div>
                                        <div style="text-align: center;">
                                                    <h4 style="margin: 0 0 5px 0; color: #333;">${member.name}</h4>
                                                    <p style="margin: 0 0 5px 0; color: #666; font-size: 14px;">${member.position}</p>
                                                    <p style="margin: 0 0 15px 0; color: #4c6ef5; font-size: 14px;">${member.phone}</p>
                                                    
                                                    ${member.performance ? `
                                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%;">
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">$${member.performance.medianSoldPrice}k</div>
                                                            <div style="font-size: 12px; color: #666;">Median sold price</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">${member.performance.medianDaysAdvertised}</div>
                                                            <div style="font-size: 12px; color: #666;">Median days advertised</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">${member.performance.propertiesSoldLead}</div>
                                                            <div style="font-size: 12px; color: #666;">Properties sold (as lead)</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">${member.performance.propertiesSoldSecondary}</div>
                                                            <div style="font-size: 12px; color: #666;">Properties sold (as secondary)</div>
                                                        </div>
                                                    </div>
                                                    ` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                                    </div>
                                </div>

                                <div class="staff-category" data-category="property" style="display: none; margin-top: 20px;">
                                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px;">
                                        ${agency.staff.filter(member => 
                                            member.position.toLowerCase().includes('property manager')
                                        ).map(member => `
                                            <div class="staff-member" 
                                                 onclick="showStaffModal(${JSON.stringify(member).replace(/"/g, '&quot;')})"
                                                 style="display: flex; flex-direction: column; align-items: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                                                <div class="staff-photo-container">
                                                    <img src="${member.photo}" alt="${member.name}" class="staff-photo">
                                                </div>
                                                <div style="text-align: center;">
                                                    <h4 style="margin: 0 0 5px 0; color: #333;">${member.name}</h4>
                                                    <p style="margin: 0 0 5px 0; color: #666; font-size: 14px;">${member.position}</p>
                                                    <p style="margin: 0 0 15px 0; color: #4c6ef5; font-size: 14px;">${member.phone}</p>
                                                    
                                                    ${member.performance ? `
                                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%;">
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">${member.performance.propertiesLeased}</div>
                                                            <div style="font-size: 12px; color: #666;">Properties Leased</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">$${member.performance.medianLeasedPrice}</div>
                                                            <div style="font-size: 12px; color: #666;">Median Leased Price</div>
                                                        </div>
                                                    </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>

                                <div class="staff-category" data-category="bdm" style="display: none; margin-top: 20px;">
                                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px;">
                                        ${agency.staff.filter(member => 
                                            member.position.toLowerCase().includes('business development')
                                        ).map(member => `
                                            <div class="staff-member" 
                                                 onclick="showStaffModal(${JSON.stringify(member).replace(/"/g, '&quot;')})"
                                                 style="display: flex; flex-direction: column; align-items: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                                                <div class="staff-photo-container">
                                                    <img src="${member.photo}" alt="${member.name}" class="staff-photo">
                                                </div>
                                                <div style="text-align: center;">
                                                    <h4 style="margin: 0 0 5px 0; color: #333;">${member.name}</h4>
                                                    <p style="margin: 0 0 5px 0; color: #666; font-size: 14px;">${member.position}</p>
                                                    <p style="margin: 0 0 15px 0; color: #4c6ef5; font-size: 14px;">${member.phone}</p>
                                                    
                                                    ${member.performance ? `
                                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%;">
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">$${member.performance.medianSoldPrice}k</div>
                                                            <div style="font-size: 12px; color: #666;">Median sold price</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">${member.performance.medianDaysAdvertised}</div>
                                                            <div style="font-size: 12px; color: #666;">Median days advertised</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">${member.performance.propertiesSoldLead}</div>
                                                            <div style="font-size: 12px; color: #666;">Properties sold (as lead)</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">${member.performance.propertiesSoldSecondary}</div>
                                                            <div style="font-size: 12px; color: #666;">Properties sold (as secondary)</div>
                                                        </div>
                                                    </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>

                                <div class="staff-category" data-category="leasing" style="display: none; margin-top: 20px;">
                                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px;">
                                        ${agency.staff.filter(member => 
                                            member.position.toLowerCase().includes('leasing')
                                        ).map(member => `
                                            <div class="staff-member" 
                                                 onclick="showStaffModal(${JSON.stringify(member).replace(/"/g, '&quot;')})"
                                                 style="display: flex; flex-direction: column; align-items: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                                                <div class="staff-photo-container">
                                                    <img src="${member.photo}" alt="${member.name}" class="staff-photo">
                                                </div>
                                                <div style="text-align: center;">
                                                    <h4 style="margin: 0 0 5px 0; color: #333;">${member.name}</h4>
                                                    <p style="margin: 0 0 5px 0; color: #666; font-size: 14px;">${member.position}</p>
                                                    <p style="margin: 0 0 15px 0; color: #4c6ef5; font-size: 14px;">${member.phone}</p>
                                                    
                                                    ${member.performance ? `
                                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%;">
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">$${member.performance.medianSoldPrice}k</div>
                                                            <div style="font-size: 12px; color: #666;">Median sold price</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">${member.performance.medianDaysAdvertised}</div>
                                                            <div style="font-size: 12px; color: #666;">Median days advertised</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">${member.performance.propertiesSoldLead}</div>
                                                            <div style="font-size: 12px; color: #666;">Properties sold (as lead)</div>
                                                        </div>
                                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                                                            <div style="font-size: 20px; font-weight: bold; color: #4c6ef5; margin-bottom: 5px;">${member.performance.propertiesSoldSecondary}</div>
                                                            <div style="font-size: 12px; color: #666;">Properties sold (as secondary)</div>
                                                        </div>
                                                    </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;

                const infoWindow = new google.maps.InfoWindow({
                    content: infoContent,
                    maxWidth: agency.name === 'Woodards' ? 1200 : 600,
                    maxHeight: window.innerHeight * 0.9
                });

                marker.addListener('click', () => {
                    if (currentInfoWindow) {
                        currentInfoWindow.close();
                    }
                    infoWindow.open(map, marker);
                    currentInfoWindow = infoWindow;
                    
                    // Center the map on the marker with offset
                    const point = map.getProjection().fromLatLngToPoint(marker.getPosition());
                    point.y -= window.innerHeight * 0.2; // Offset by 20% of window height
                    const offsetLatLng = map.getProjection().fromPointToLatLng(point);
                    map.panTo(offsetLatLng);
                });

                // Create agency card
                const card = document.createElement('div');
                card.className = 'agency-card';
                card.innerHTML = `
                    <div class="agency-name">${agency.name}</div>
                    <div class="agency-address">${agency.address}</div>
                    ${agency.phone ? `<div class="agency-phone">${agency.phone}</div>` : ''}
                    
                    <div class="agency-stats">
                        <div class="stat-item">
                            <span class="stat-label">Median Lease</span>
                            <span class="stat-value">$${agency.medianLeasePrice}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Days Listed</span>
                            <span class="stat-value">${agency.medianDaysAdvertised}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Properties Leased</span>
                            <span class="stat-value">${agency.propertiesLeased}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Available Now</span>
                            <span class="stat-value">${agency.propertiesForRent}</span>
                        </div>
                    </div>

                    ${agency.staff ? `
                    <div class="staff-section">
                        <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">Our Team</h3>
                        <div class="staff-grid">
                            ${agency.staff.map(member => `
                                <div class="staff-item" onclick="showStaffModal(${JSON.stringify(member).replace(/"/g, '&quot;')})">
                                    <div style="font-weight: bold; color: #4c6ef5; margin-bottom: 4px;">${member.name}</div>
                                    <div style="font-size: 12px; color: #666; margin-bottom: 4px;">${member.position}</div>
                                    <div style="font-size: 12px; color: #4c6ef5;">${member.phone}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                `;

                card.addEventListener('click', () => {
                    map.setCenter(position);
                    map.setZoom(16);
                    if (currentInfoWindow) {
                        currentInfoWindow.close();
                    }
                    infoWindow.open(map, marker);
                    currentInfoWindow = infoWindow;
                });

                agencyList.appendChild(card);
            });

            // Fit map to show all markers with padding
            map.fitBounds(bounds, { 
                padding: {
                    top: 50,
                    right: 50,
                    bottom: 50,
                    left: 50
                }
            });

            // Set minimum zoom level to ensure good visibility
            const listener = google.maps.event.addListener(map, 'idle', function() {
                if (map.getZoom() > 14) {
                    map.setZoom(14);
                }
                google.maps.event.removeListener(listener);
            });
        }

        function toggleReviews(button, agencyId) {
            const reviewsList = document.querySelector(`.reviews-list[data-agency="${agencyId}"]`);
            if (reviewsList.style.display === 'none') {
                reviewsList.style.display = 'block';
                button.textContent = 'Hide Reviews';
            } else {
                reviewsList.style.display = 'none';
                button.textContent = 'Show Reviews';
            }
        }

        function toggleStaff(button, agencyId) {
            const staffList = document.querySelector(`.staff-list[data-agency="${agencyId}"]`);
            if (staffList.style.display === 'none' || !staffList.style.display) {
                staffList.style.display = 'block';
                button.textContent = 'Hide Staff';
            } else {
                staffList.style.display = 'none';
                button.textContent = 'Show Staff';
            }
        }

        function closeInfoWindow() {
            if (currentInfoWindow) {
                currentInfoWindow.close();
                currentInfoWindow = null;
            }
        }

        function showStaffModal(member) {
            console.log('Opening modal for:', member);
            console.log('Photo path:', member.photo);
            
            const modal = document.getElementById('staff-modal');
            const backdrop = document.getElementById('modal-backdrop');
            
            // Special handling for Grant Wallace's profile
            const isGrantWallace = member.name === "Grant Wallace";
            const isMarkKonishi = member.name === "Mark Konishi";
            const isNickGatacre = member.name === "Nick Gatacre";
            const isAnthonyBenic = member.name === "Anthony Benic";
            
            const grantWallaceData = {
                performance: {
                    medianSoldPrice: "780k",
                    medianDaysAdvertised: 29,
                    propertiesSoldLead: 26,
                    propertiesSoldSecondary: 23
                }
            };

            const markKonishiData = {
                performance: {
                    medianSoldPrice: "590k",
                    medianDaysAdvertised: 43,
                    propertiesSoldLead: 37,
                    propertiesSoldSecondary: 60
                }
            };

            const nickGatacreData = {
                performance: {
                    medianSoldPrice: "835k",
                    medianDaysAdvertised: 28,
                    propertiesSoldLead: 26,
                    propertiesSoldSecondary: 4
                }
            };

            const anthonyBenicData = {
                name: "Anthony Benic",
                position: "Sales Associate",
                phone: "0466 474 536",
                photo: "/images/agents/Suburbs/South Yarra - 3141/Belle Property/anthony benic.jpg",
                performance: {
                    medianSoldPrice: "445k",
                    medianDaysAdvertised: 42,
                    propertiesSoldLead: 35,
                    propertiesSoldSecondary: 14
                }
            };
            
            modal.innerHTML = `
                <div class="staff-modal-header">
                    <button class="staff-modal-close" onclick="closeStaffModal()">×</button>
                </div>
                <div class="staff-modal-content" style="max-width: 600px; width: 100%; padding: 0;">
                    <div style="position: relative; width: 100%; background: white; border-radius: 12px; overflow: hidden;">
                        ${isGrantWallace || isMarkKonishi || isNickGatacre || isAnthonyBenic ? `
                            <!-- Belle Property Logo -->
                            <div style="padding: 30px 30px 0; text-align: center; background: linear-gradient(to bottom, #f8f9fa, white);">
                                <img src="/images/agents/Suburbs/South Yarra - 3141/Belle Property/belle property logo.png" 
                                     alt="Belle Property Logo" 
                                     style="height: 160px; width: auto; margin-bottom: 20px;">
                    </div>
                        ` : ''}
                        <!-- Profile Section with Circular Image -->
                        <div style="padding: 40px 30px; text-align: center; background: linear-gradient(to bottom, #f8f9fa, white);">
                            <div style="width: 180px; height: 180px; margin: 0 auto 25px; border-radius: 50%; overflow: hidden; border: 4px solid white; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                <img src="${member.photo}" alt="${member.name}" style="width: 100px; height: 100px; border-radius: 50%; margin-bottom: 10px; object-fit: cover;">
                            </div>
                            <h2 style="margin: 0 0 8px 0; color: #333; font-size: 32px; font-weight: 600;">${member.name}</h2>
                            <p style="margin: 0 0 8px 0; color: #666; font-size: 18px; font-weight: 500;">${member.position}</p>
                            <p style="margin: 0; color: #4c6ef5; font-size: 18px; font-weight: 500;">${member.phone}</p>
                        </div>

                        <!-- Performance Metrics Section -->
                        <div style="padding: 0 30px 30px;">
                            ${isGrantWallace || isMarkKonishi || isNickGatacre || isAnthonyBenic ? `
                                <!-- Overall Performance Section -->
                                <div style="margin-bottom: 30px;">
                                    <h3 style="margin: 0 0 25px 0; color: #333; font-size: 22px; font-weight: 600; text-align: center; position: relative;">
                                        <span style="background: white; padding: 0 15px; position: relative; z-index: 1;">Overall Performance</span>
                                        <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: #e0e0e0; z-index: 0;"></div>
                                    </h3>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                                        <!-- Median Sold Price -->
                                        <div style="background: #f8f9fa; padding: 17px; border-radius: 12px; text-align: center; transition: transform 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                            <div style="font-size: 21px; font-weight: bold; color: #4c6ef5; margin-bottom: 6px; font-family: 'Inter', -apple-system, sans-serif;">$${
                                                isGrantWallace ? grantWallaceData.performance.medianSoldPrice :
                                                isMarkKonishi ? markKonishiData.performance.medianSoldPrice :
                                                isNickGatacre ? nickGatacreData.performance.medianSoldPrice :
                                                isAnthonyBenic ? anthonyBenicData.performance.medianSoldPrice : ''
                                            }</div>
                                            <div style="font-size: 9px; color: #666; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">Median Sold Price</div>
                            </div>

                                        <!-- Median Days Advertised -->
                                        <div style="background: #f8f9fa; padding: 17px; border-radius: 12px; text-align: center; transition: transform 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                            <div style="font-size: 21px; font-weight: bold; color: #4c6ef5; margin-bottom: 6px; font-family: 'Inter', -apple-system, sans-serif;">${
                                                isGrantWallace ? grantWallaceData.performance.medianDaysAdvertised :
                                                isMarkKonishi ? markKonishiData.performance.medianDaysAdvertised :
                                                isNickGatacre ? nickGatacreData.performance.medianDaysAdvertised :
                                                isAnthonyBenic ? anthonyBenicData.performance.medianDaysAdvertised : ''
                                            }</div>
                                            <div style="font-size: 9px; color: #666; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">Median Days Advertised</div>
                            </div>

                                        <!-- Properties Sold (Lead) -->
                                        <div style="background: #f8f9fa; padding: 17px; border-radius: 12px; text-align: center; transition: transform 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                            <div style="font-size: 21px; font-weight: bold; color: #4c6ef5; margin-bottom: 6px; font-family: 'Inter', -apple-system, sans-serif;">${
                                                isGrantWallace ? grantWallaceData.performance.propertiesSoldLead :
                                                isMarkKonishi ? markKonishiData.performance.propertiesSoldLead :
                                                isNickGatacre ? nickGatacreData.performance.propertiesSoldLead :
                                                isAnthonyBenic ? anthonyBenicData.performance.propertiesSoldLead : ''
                                            }</div>
                                            <div style="font-size: 9px; color: #666; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">Properties Sold<br>(as lead)</div>
                            </div>

                                        <!-- Properties Sold (Secondary) -->
                                        <div style="background: #f8f9fa; padding: 17px; border-radius: 12px; text-align: center; transition: transform 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                            <div style="font-size: 21px; font-weight: bold; color: #4c6ef5; margin-bottom: 6px; font-family: 'Inter', -apple-system, sans-serif;">${
                                                isGrantWallace ? grantWallaceData.performance.propertiesSoldSecondary :
                                                isMarkKonishi ? markKonishiData.performance.propertiesSoldSecondary :
                                                isNickGatacre ? nickGatacreData.performance.propertiesSoldSecondary :
                                                isAnthonyBenic ? anthonyBenicData.performance.propertiesSoldSecondary : ''
                                            }</div>
                                            <div style="font-size: 9px; color: #666; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">Properties Sold<br>(as secondary)</div>
                            </div>
                        </div>
                                </div>
                            ` : `
                                <!-- Default Performance Metrics -->
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                                    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; text-align: center; transition: transform 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                        <div style="font-size: 36px; font-weight: bold; color: #4c6ef5; margin-bottom: 10px; font-family: 'Inter', -apple-system, sans-serif;">$${member.performance?.medianSoldPrice}k</div>
                                        <div style="font-size: 15px; color: #666; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">Median Sold Price</div>
                                    </div>
                                    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; text-align: center; transition: transform 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                        <div style="font-size: 36px; font-weight: bold; color: #4c6ef5; margin-bottom: 10px; font-family: 'Inter', -apple-system, sans-serif;">${member.performance?.medianDaysAdvertised}</div>
                                        <div style="font-size: 15px; color: #666; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">Median Days Advertised</div>
                                    </div>
                                    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; text-align: center; transition: transform 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                        <div style="font-size: 36px; font-weight: bold; color: #4c6ef5; margin-bottom: 10px; font-family: 'Inter', -apple-system, sans-serif;">${member.performance?.propertiesSoldLead}</div>
                                        <div style="font-size: 15px; color: #666; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">Properties Sold<br>(as lead)</div>
                                    </div>
                                    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; text-align: center; transition: transform 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                        <div style="font-size: 36px; font-weight: bold; color: #4c6ef5; margin-bottom: 10px; font-family: 'Inter', -apple-system, sans-serif;">${member.performance?.propertiesSoldSecondary}</div>
                                        <div style="font-size: 15px; color: #666; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">Properties Sold<br>(as secondary)</div>
                                    </div>
                                </div>
                            `}

                            <!-- Compare Button -->
                            <button onclick="showComparisonInModal(${JSON.stringify(member).replace(/"/g, '&quot;')})" 
                                    style="width: 100%; margin-top: 30px; padding: 15px; background: #4c6ef5; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.2s; box-shadow: 0 2px 8px rgba(76,110,245,0.3);">
                                Compare with Other Agents
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
            backdrop.style.display = 'block';
        }

        function showComparisonInModal(selectedMember) {
            const modal = document.getElementById('staff-modal');
            const backdrop = document.getElementById('modal-backdrop');
            
            // Get all agents from all agencies
            const allAgents = allAgencies.flatMap(agency => 
                agency.agents.map(agent => ({
                    ...agent,
                    agency: agency.name
                }))
            );
            
            // Filter agents by the same category as the selected member
            const position = selectedMember.position.toLowerCase();
            const category = position.includes('sales') || position.includes('principal') || position.includes('director') ? 'sales' : 'property';
            
            const filteredAgents = allAgents.filter(agent => {
                const agentPosition = agent.position.toLowerCase();
                return category === 'sales' ? 
                    (agentPosition.includes('sales') || agentPosition.includes('principal') || agentPosition.includes('director')) : 
                    agentPosition.includes('property manager');
            });

            // Remove the selected agent from the list
            const otherAgents = filteredAgents.filter(agent => 
                agent.name !== selectedMember.name || agent.agency !== selectedMember.agency
            );
            
            modal.innerHTML = `
                <div class="staff-modal-header">
                    <button class="staff-modal-close" onclick="closeStaffModal()">×</button>
                </div>
                <div class="staff-modal-content" style="max-width: 800px; width: 100%;">
                    <h2 style="margin-bottom: 20px; color: #333;">Compare Agents</h2>
                    
                    <div class="category-tabs">
                        <div class="category-tab ${category === 'sales' ? 'active' : ''}" onclick="switchCategoryInModal('sales')">Sales Agents</div>
                        <div class="category-tab ${category === 'property' ? 'active' : ''}" onclick="switchCategoryInModal('property')">Property Managers</div>
                    </div>

                    <div class="filter-buttons">
                        ${category === 'sales' ? `
                            <button class="filter-button" onclick="sortAgentsInModal('medianSoldPrice')">
                                Median Sold Price
                                <span class="sort-icon">↓</span>
                            </button>
                            <button class="filter-button" onclick="sortAgentsInModal('medianDaysAdvertised')">
                                Days Advertised
                                <span class="sort-icon">↓</span>
                            </button>
                            <button class="filter-button" onclick="sortAgentsInModal('propertiesSoldLead')">
                                Properties Sold (Lead)
                                <span class="sort-icon">↓</span>
                            </button>
                            <button class="filter-button" onclick="sortAgentsInModal('propertiesSoldSecondary')">
                                Properties Sold (Secondary)
                                <span class="sort-icon">↓</span>
                            </button>
                        ` : `
                            <button class="filter-button" onclick="sortAgentsInModal('propertiesLeased')">
                                Properties Leased
                                <span class="sort-icon">↓</span>
                            </button>
                        `}
                    </div>

                    <div class="compare-container">
                        <div class="agent-selector">
                            <h3>Selected Agent</h3>
                            <div class="agent-list">
                                <div class="agent-item selected">
                                    <img src="${selectedMember.photo}" alt="${selectedMember.name}" onerror="this.src='https://via.placeholder.com/40'">
                                    <div class="agent-info">
                                        <div class="agent-name">${selectedMember.name}</div>
                                        <div class="agent-details">${selectedMember.position} at ${selectedMember.agency}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="agent-selector">
                            <h3>Compare With</h3>
                            <div class="search-container">
                                <input type="text" class="search-input" placeholder="Search agents..." oninput="filterAgentsInModal(this.value)">
                            </div>
                            <div class="agent-list" id="compareAgentList">
                                ${otherAgents.map(agent => `
                                    <div class="agent-item" onclick="selectAgentForComparison(${JSON.stringify(agent).replace(/"/g, '&quot;')})">
                                        <img src="${agent.photo}" alt="${agent.name}" onerror="this.src='https://via.placeholder.com/40'">
                                        <div class="agent-info">
                                            <div class="agent-name">${agent.name}</div>
                                            <div class="agent-details">${agent.position} at ${agent.agency}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <div id="comparisonStats" class="comparison-stats" style="display: none;">
                        <h3>Performance Comparison</h3>
                        <div class="stat-grid">
                            ${category === 'sales' ? `
                                <div class="stat-card">
                                    <div class="stat-title">Median Sold Price</div>
                                    <div class="stat-value" id="price1"></div>
                                    <div class="difference-indicator" id="priceDiff"></div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-title">Median Days Advertised</div>
                                    <div class="stat-value" id="days1"></div>
                                    <div class="difference-indicator" id="daysDiff"></div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-title">Properties Sold (Lead)</div>
                                    <div class="stat-value" id="lead1"></div>
                                    <div class="difference-indicator" id="leadDiff"></div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-title">Properties Sold (Secondary)</div>
                                    <div class="stat-value" id="secondary1"></div>
                                    <div class="difference-indicator" id="secondaryDiff"></div>
                                </div>
                            ` : `
                                <div class="stat-card">
                                    <div class="stat-title">Properties Leased</div>
                                    <div class="stat-value" id="leased1"></div>
                                    <div class="difference-indicator" id="leasedDiff"></div>
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        function filterAgentsInModal(searchTerm) {
            const agentList = document.getElementById('compareAgentList');
            const items = agentList.querySelectorAll('.agent-item');
            
            items.forEach(item => {
                const name = item.querySelector('.agent-name').textContent.toLowerCase();
                const position = item.querySelector('.agent-details').textContent.toLowerCase();
                const matches = name.includes(searchTerm.toLowerCase()) || position.includes(searchTerm.toLowerCase());
                item.style.display = matches ? 'flex' : 'none';
            });
        }

        function selectAgentForComparison(agent) {
            const agentList = document.getElementById('compareAgentList');
            agentList.querySelectorAll('.agent-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            updateComparisonStatsInModal(agent);
        }

        function updateComparisonStatsInModal(selectedAgent) {
            const selectedMember = JSON.parse(event.currentTarget.getAttribute('data-member'));
            document.getElementById('comparisonStats').style.display = 'block';

            const position = selectedMember.position.toLowerCase();
            const category = position.includes('sales') || position.includes('principal') || position.includes('director') ? 'sales' : 'property';

            if (category === 'sales') {
                // Update values for the selected member (sales agent)
                document.getElementById('price1').textContent = `$${selectedMember.performance.medianSoldPrice.toLocaleString()}`;
                document.getElementById('days1').textContent = selectedMember.performance.medianDaysAdvertised;
                document.getElementById('lead1').textContent = selectedMember.performance.propertiesSoldLead;
                document.getElementById('secondary1').textContent = selectedMember.performance.propertiesSoldSecondary;

                // Calculate and display differences
                updateDifference('priceDiff', selectedMember.performance.medianSoldPrice, selectedAgent.performance.medianSoldPrice, true);
                updateDifference('daysDiff', selectedMember.performance.medianDaysAdvertised, selectedAgent.performance.medianDaysAdvertised, false);
                updateDifference('leadDiff', selectedMember.performance.propertiesSoldLead, selectedAgent.performance.propertiesSoldLead, true);
                updateDifference('secondaryDiff', selectedMember.performance.propertiesSoldSecondary, selectedAgent.performance.propertiesSoldSecondary, true);
            } else {
                // Update values for the selected member (property manager)
                document.getElementById('leased1').textContent = selectedMember.performance.propertiesLeased;

                // Calculate and display differences
                updateDifference('leasedDiff', selectedMember.performance.propertiesLeased, selectedAgent.performance.propertiesLeased, true);
            }
        }

        function switchCategoryInModal(category) {
            const tabs = document.querySelectorAll('.category-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.textContent.toLowerCase().includes(category)) {
                    tab.classList.add('active');
                }
            });

            // Get all agents from all agencies
            const allAgents = allAgencies.flatMap(agency => 
                agency.agents.map(agent => ({
                    ...agent,
                    agency: agency.name
                }))
            );

            // Filter agents by category
            const filteredAgents = allAgents.filter(agent => 
                category === 'sales' ? 
                    (agent.position.toLowerCase().includes('sales') || agent.position.toLowerCase().includes('principal') || agent.position.toLowerCase().includes('director')) : 
                    agent.position.toLowerCase().includes('property manager')
            );

            // Update the compare agent list
            const agentList = document.getElementById('compareAgentList');
            agentList.innerHTML = filteredAgents.map(agent => `
                <div class="agent-item" onclick="selectAgentForComparison(${JSON.stringify(agent).replace(/"/g, '&quot;')})">
                    <img src="${agent.photo}" alt="${agent.name}" onerror="this.src='https://via.placeholder.com/40'">
                    <div class="agent-info">
                        <div class="agent-name">${agent.name}</div>
                        <div class="agent-details">${agent.position} at ${agent.agency}</div>
                    </div>
                </div>
            `).join('');
        }

        function sortAgentsInModal(metric) {
            const button = event.currentTarget;
            const icon = button.querySelector('.sort-icon');
            const isAscending = !button.classList.contains('active') || icon.classList.contains('asc');
            
            // Update button state
            document.querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active');
                btn.querySelector('.sort-icon').classList.remove('asc');
            });
            
            button.classList.add('active');
            icon.classList.toggle('asc', isAscending);
            
            // Get all agents from the compare list
            const agentList = document.getElementById('compareAgentList');
            const agents = Array.from(agentList.querySelectorAll('.agent-item')).map(item => 
                JSON.parse(item.getAttribute('data-member'))
            );
            
            // Sort agents
            agents.sort((a, b) => {
                const valueA = a.performance[metric];
                const valueB = b.performance[metric];
                return isAscending ? valueA - valueB : valueB - valueA;
            });
            
            // Update the list
            agentList.innerHTML = agents.map(agent => `
                <div class="agent-item" onclick="selectAgentForComparison(${JSON.stringify(agent).replace(/"/g, '&quot;')})">
                    <img src="${agent.photo}" alt="${agent.name}" onerror="this.src='https://via.placeholder.com/40'">
                    <div class="agent-info">
                        <div class="agent-name">${agent.name}</div>
                        <div class="agent-details">${agent.position} at ${agent.agency}</div>
                    </div>
                </div>
            `).join('');
        }

        function closeStaffModal() {
            const modal = document.getElementById('staff-modal');
            const backdrop = document.getElementById('modal-backdrop');
            modal.style.display = 'none';
            backdrop.style.display = 'none';
        }

        function openCompareModal() {
            return false; // Disabled
        }

        function compareAgents() {
            return false; // Disabled
        }

        function showAgentComparison() {
            return false; // Disabled
        }

        function switchCategory(category) {
            currentCategory = category;
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.textContent.toLowerCase().includes(category)) {
                    tab.classList.add('active');
                }
            });

            // Get all agents from all agencies
            const allAgents = allAgencies.flatMap(agency => 
                agency.agents.map(agent => ({
                    ...agent,
                    agency: agency.name
                }))
            );

            // Filter agents by category
            const filteredAgents = allAgents.filter(agent => 
                category === 'sales' ? 
                    agent.position.toLowerCase().includes('sales') : 
                    agent.position.toLowerCase().includes('property manager')
            );

            // Clear previous selections
            document.getElementById('firstAgentList').innerHTML = '';
            document.getElementById('secondAgentList').innerHTML = '';
            document.getElementById('comparisonStats').style.display = 'none';
            document.getElementById('rankedList').style.display = 'none';

            // Render agent lists
            renderAgentList('firstAgentList', filteredAgents, 'firstAgent');
            renderAgentList('secondAgentList', filteredAgents, 'secondAgent');

            // Reset search inputs
            document.getElementById('firstAgentSearch').value = '';
            document.getElementById('secondAgentSearch').value = '';

            // Reset filter buttons
            document.querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active');
                btn.querySelector('.sort-icon').classList.remove('asc');
            });
        }

        function renderAgentList(listId, agents, agentPrefix) {
            const list = document.getElementById(listId);
            list.innerHTML = '';

            if (agents.length === 0) {
                list.innerHTML = '<div class="no-results">No agents found</div>';
                return;
            }

            agents.forEach(agent => {
                const item = document.createElement('div');
                item.className = 'agent-item';
                item.innerHTML = `
                    <img src="${agent.photo}" alt="${agent.name}" onerror="this.src='https://via.placeholder.com/40'">
                    <div class="agent-info">
                        <div class="agent-name">${agent.name}</div>
                        <div class="agent-details">${agent.position} at ${agent.agency}</div>
                        <div class="agent-performance">
                            <span>Median Price: $${agent.performance.medianSoldPrice.toLocaleString()}</span>
                            <span>Days: ${agent.performance.medianDaysAdvertised}</span>
                            <span>Lead: ${agent.performance.propertiesSoldLead}</span>
                        </div>
                    </div>
                `;
                item.onclick = () => selectAgent(agent, agentPrefix);
                list.appendChild(item);
            });
        }

        function selectAgent(agent, prefix) {
            // Remove selection from other items in the same list
            const list = document.getElementById(`${prefix}List`);
            list.querySelectorAll('.agent-item').forEach(item => {
                item.classList.remove('selected');
            });

            // Add selection to clicked item
            event.currentTarget.classList.add('selected');

            // Update comparison stats if both agents are selected
            const firstAgent = document.querySelector('#firstAgentList .selected');
            const secondAgent = document.querySelector('#secondAgentList .selected');

            if (firstAgent && secondAgent) {
                updateComparisonStats();
            }
        }

        function updateComparisonStats() {
            const firstAgent = getSelectedAgentData('firstAgentList');
            const secondAgent = getSelectedAgentData('secondAgentList');

            if (!firstAgent || !secondAgent) return;

            // Show comparison stats
            document.getElementById('comparisonStats').style.display = 'block';

            // Update values
            document.getElementById('price1').textContent = `$${firstAgent.performance.medianSoldPrice.toLocaleString()}`;
            document.getElementById('days1').textContent = firstAgent.performance.medianDaysAdvertised;
            document.getElementById('lead1').textContent = firstAgent.performance.propertiesSoldLead;
            document.getElementById('secondary1').textContent = firstAgent.performance.propertiesSoldSecondary;

            // Calculate and display differences
            updateDifference('priceDiff', firstAgent.performance.medianSoldPrice, secondAgent.performance.medianSoldPrice, true);
            updateDifference('daysDiff', firstAgent.performance.medianDaysAdvertised, secondAgent.performance.medianDaysAdvertised, false);
            updateDifference('leadDiff', firstAgent.performance.propertiesSoldLead, secondAgent.performance.propertiesSoldLead, true);
            updateDifference('secondaryDiff', firstAgent.performance.propertiesSoldSecondary, secondAgent.performance.propertiesSoldSecondary, true);
        }

        function getSelectedAgentData(listId) {
            const selectedItem = document.querySelector(`#${listId} .selected`);
            if (!selectedItem) return null;

            const agentName = selectedItem.querySelector('.agent-name').textContent;
            const agentDetails = selectedItem.querySelector('.agent-details').textContent;
            const [position, agency] = agentDetails.split(' at ');

            return allAgencies
                .find(a => a.name === agency)
                ?.agents.find(a => a.name === agentName);
        }

        function updateDifference(elementId, value1, value2, higherIsBetter) {
            const diff = value1 - value2;
            const element = document.getElementById(elementId);
            const arrow = diff > 0 ? '↑' : '↓';
            const color = (diff > 0 && higherIsBetter) || (diff < 0 && !higherIsBetter) ? 'better' : 'worse';
            
            element.innerHTML = `
                <span class="${color}">${arrow}</span>
                <span class="difference-value ${color}">${formatDifference(diff, higherIsBetter)}</span>
            `;
        }

        function formatDifference(diff, higherIsBetter) {
            if (higherIsBetter) {
                return diff > 0 ? `+${diff.toLocaleString()}` : diff.toLocaleString();
            } else {
                return diff < 0 ? `+${Math.abs(diff).toLocaleString()}` : `-${diff.toLocaleString()}`;
            }
        }

        function sortAgents(metric) {
            const button = event.currentTarget;
            const icon = button.querySelector('.sort-icon');
            const isAscending = !button.classList.contains('active') || icon.classList.contains('asc');
            
            // Update button state
            document.querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active');
                btn.querySelector('.sort-icon').classList.remove('asc');
            });
            
            button.classList.add('active');
            icon.classList.toggle('asc', isAscending);
            
            // Get all agents from all agencies
            const allAgents = allAgencies.flatMap(agency => 
                agency.agents.map(agent => ({
                    ...agent,
                    agency: agency.name
                }))
            );

            // Filter for sales agents only
            const salesAgents = allAgents.filter(agent => 
                agent.position.toLowerCase().includes('sales')
            );
            
            // Sort agents
            salesAgents.sort((a, b) => {
                const valueA = a.performance[metric];
                const valueB = b.performance[metric];
                return isAscending ? valueA - valueB : valueB - valueA;
            });
            
            // Show ranked list
            showRankedList(salesAgents, metric, isAscending);
        }

        function showRankedList(agents, metric, isAscending) {
            const rankedList = document.getElementById('rankedList');
            const rankedListContent = document.getElementById('rankedListContent');
            const metricLabels = {
                medianSoldPrice: 'Median Sold Price',
                medianDaysAdvertised: 'Days Advertised',
                propertiesSoldLead: 'Properties Sold (Lead)',
                propertiesSoldSecondary: 'Properties Sold (Secondary)'
            };

            rankedListContent.innerHTML = agents.map((agent, index) => {
                const value = agent.performance[metric];
                const formattedValue = metric === 'medianSoldPrice' 
                    ? `$${value.toLocaleString()}`
                    : value.toLocaleString();

                return `
                    <div class="ranked-item">
                        <div class="rank-number">${index + 1}</div>
                        <div class="rank-agent-info">
                            <img src="${agent.photo}" alt="${agent.name}" class="rank-agent-photo" 
                                 onerror="this.src='https://via.placeholder.com/40'">
                            <div class="rank-agent-details">
                                <div class="rank-agent-name">${agent.name}</div>
                                <div class="rank-agent-position">${agent.position} at ${agent.agency}</div>
                            </div>
                        </div>
                        <div class="rank-value">${formattedValue}</div>
                        <div class="rank-value">${agent.performance.medianDaysAdvertised} days</div>
                        <div class="rank-value">${agent.performance.propertiesSoldLead}</div>
                    </div>
                `;
            }).join('');

            rankedList.style.display = 'block';
        }

        function closeRankedList() {
            document.getElementById('rankedList').style.display = 'none';
            document.querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active');
                btn.querySelector('.sort-icon').classList.remove('asc');
            });
        }

        function toggleStaffCategory(button, category, agencyName) {
            // Remove active class from all buttons
            document.querySelectorAll('.staff-category-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = 'white';
                btn.style.color = '#4c6ef5';
            });
            
            // Add active class to clicked button
            button.classList.add('active');
            button.style.background = '#4c6ef5';
            button.style.color = 'white';
            
            // Hide all staff categories
            document.querySelectorAll('.staff-category').forEach(div => {
                div.style.display = 'none';
            });
            
            // Show selected category
            const selectedCategory = document.querySelector(`.staff-category[data-category="${category}"]`);
            if (selectedCategory) {
                selectedCategory.style.display = 'block';
            }
        }

        // Initialize the map
        initMap();

        // Add this new JavaScript function
        if (typeof isCompareMode === 'undefined') {
            var isCompareMode = false;
        }
        if (typeof selectedAgentsForComparison === 'undefined') {
            var selectedAgentsForComparison = [];
        }

        function toggleCompareMode(button) {
            isCompareMode = !isCompareMode;
            
            if (isCompareMode) {
                // Activate compare mode
                button.style.background = '#4c6ef5';
                button.style.color = 'white';
                button.textContent = 'Select Agents to Compare';
                
                // Add click handlers for comparison
                document.querySelectorAll('.staff-member').forEach(member => {
                    member.onclick = function(e) {
                        e.preventDefault();
                        if (selectedAgentsForComparison.length < 2 || this.classList.contains('selected-for-comparison')) {
                            this.classList.toggle('selected-for-comparison');
                            
                            if (this.classList.contains('selected-for-comparison')) {
                                // Add to comparison
                                const memberData = JSON.parse(this.getAttribute('onclick').split('showStaffModal(')[1].split(')')[0]);
                                if (!selectedAgentsForComparison.find(agent => agent.name === memberData.name)) {
                                    selectedAgentsForComparison.push(memberData);
                                }
                                this.style.border = '3px solid #4c6ef5';
                                this.style.transform = 'scale(1.05)';
                            } else {
                                // Remove from comparison
                                const memberData = JSON.parse(this.getAttribute('onclick').split('showStaffModal(')[1].split(')')[0]);
                                selectedAgentsForComparison = selectedAgentsForComparison.filter(agent => agent.name !== memberData.name);
                                this.style.border = 'none';
                                this.style.transform = 'none';
                            }
                            
                            // If we have 2 agents selected, show comparison
                            if (selectedAgentsForComparison.length === 2) {
                                showAgentComparison(selectedAgentsForComparison);
                            }
                        }
                    };
                });
            } else {
                // Deactivate compare mode
                button.style.background = 'white';
                button.style.color = '#4c6ef5';
                button.textContent = 'Compare Agents';
                
                // Reset selections
                selectedAgentsForComparison = [];
                document.querySelectorAll('.staff-member').forEach(member => {
                    member.classList.remove('selected-for-comparison');
                    member.style.border = 'none';
                    member.style.transform = 'none';
                    member.onclick = function() {
                        const memberData = JSON.parse(this.getAttribute('onclick').split('showStaffModal(')[1].split(')')[0]);
                        showStaffModal(memberData);
                    };
                });
            }
        }

        function calculateDifference(value1, value2, isHigherBetter = true) {
            // Remove 'k' and '$' from values if they exist
            const v1 = parseFloat(String(value1).replace(/[k$]/g, ''));
            const v2 = parseFloat(String(value2).replace(/[k$]/g, ''));
            const diff = v1 - v2;
            const isPositive = diff > 0;
            
            // Determine if this is good (green) or bad (red)
            const isGood = isHigherBetter ? isPositive : !isPositive;
            const arrow = isPositive ? '↑' : '↓';
            const color = isGood ? '#28a745' : '#dc3545';
            
            return {
                difference: Math.abs(diff),
                arrow,
                color,
                isPositive
            };
        }

        function showAgentComparison(agents) {
            const modal = document.getElementById('staff-modal');
            const modalContent = document.createElement('div');
            modalContent.className = 'staff-modal-content';
            
            const [agent1, agent2] = agents;
            
            // Calculate differences
            const priceDiff = calculateDifference(agent1.performance.medianSoldPrice, agent2.performance.medianSoldPrice);
            const daysDiff = calculateDifference(agent1.performance.medianDaysAdvertised, agent2.performance.medianDaysAdvertised, false);
            const leadDiff = calculateDifference(agent1.performance.propertiesSoldLead, agent2.performance.propertiesSoldLead);
            const secondaryDiff = calculateDifference(agent1.performance.propertiesSoldSecondary, agent2.performance.propertiesSoldSecondary);
            
            modalContent.innerHTML = `
                <h2 style="text-align: center; margin-bottom: 30px;">Agent Comparison</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <div style="text-align: center;">
                        <img src="${agent1.photo}" alt="${agent1.name}" style="width: 150px; height: 150px; border-radius: 50%; margin-bottom: 15px;">
                        <h3 style="margin: 0 0 5px 0;">${agent1.name}</h3>
                        <p style="margin: 0; color: #666;">${agent1.position}</p>
                    </div>
                    <div style="text-align: center;">
                        <img src="${agent2.photo}" alt="${agent2.name}" style="width: 150px; height: 150px; border-radius: 50%; margin-bottom: 15px;">
                        <h3 style="margin: 0 0 5px 0;">${agent2.name}</h3>
                        <p style="margin: 0; color: #666;">${agent2.position}</p>
                    </div>
                </div>
                
                <h3 style="text-align: center; margin-bottom: 20px;">Performance Comparison</h3>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <th style="text-align: left; padding: 10px;">Metrics</th>
                        <th style="text-align: center; padding: 10px;">${agent1.name}</th>
                        <th style="text-align: center; padding: 10px;">${agent2.name}</th>
                    </tr>
                    <tr style="background: #f8f9fa;">
                        <td style="padding: 15px;">Median Sold Price</td>
                        <td style="text-align: center; padding: 15px;">
                            $${agent1.performance.medianSoldPrice}k
                            ${priceDiff.isPositive ? `<span style="color: ${priceDiff.color}"> ${priceDiff.arrow} $${priceDiff.difference}k</span>` : ''}
                        </td>
                        <td style="text-align: center; padding: 15px;">
                            $${agent2.performance.medianSoldPrice}k
                            ${!priceDiff.isPositive ? `<span style="color: ${priceDiff.color}"> ${priceDiff.arrow} $${priceDiff.difference}k</span>` : ''}
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 15px;">Days Advertised</td>
                        <td style="text-align: center; padding: 15px;">
                            ${agent1.performance.medianDaysAdvertised}
                            ${daysDiff.isPositive ? `<span style="color: ${daysDiff.color}"> ${daysDiff.arrow} ${daysDiff.difference}</span>` : ''}
                        </td>
                        <td style="text-align: center; padding: 15px;">
                            ${agent2.performance.medianDaysAdvertised}
                            ${!daysDiff.isPositive ? `<span style="color: ${daysDiff.color}"> ${daysDiff.arrow} ${daysDiff.difference}</span>` : ''}
                        </td>
                    </tr>
                    <tr style="background: #f8f9fa;">
                        <td style="padding: 15px;">Properties Sold (Lead)</td>
                        <td style="text-align: center; padding: 15px;">
                            ${agent1.performance.propertiesSoldLead}
                            ${leadDiff.isPositive ? `<span style="color: ${leadDiff.color}"> ${leadDiff.arrow} ${leadDiff.difference}</span>` : ''}
                        </td>
                        <td style="text-align: center; padding: 15px;">
                            ${agent2.performance.propertiesSoldLead}
                            ${!leadDiff.isPositive ? `<span style="color: ${leadDiff.color}"> ${leadDiff.arrow} ${leadDiff.difference}</span>` : ''}
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 15px;">Properties Sold (Secondary)</td>
                        <td style="text-align: center; padding: 15px;">
                            ${agent1.performance.propertiesSoldSecondary}
                            ${secondaryDiff.isPositive ? `<span style="color: ${secondaryDiff.color}"> ${secondaryDiff.arrow} ${secondaryDiff.difference}</span>` : ''}
                        </td>
                        <td style="text-align: center; padding: 15px;">
                            ${agent2.performance.propertiesSoldSecondary}
                            ${!secondaryDiff.isPositive ? `<span style="color: ${secondaryDiff.color}"> ${secondaryDiff.arrow} ${secondaryDiff.difference}</span>` : ''}
                        </td>
                    </tr>
                </table>
                
                <button onclick="closeStaffModal()" style="display: block; width: 100%; padding: 15px; background: #4c6ef5; color: white; border: none; border-radius: 8px; margin-top: 30px; cursor: pointer;">
                    Close Comparison
                </button>
            `;
            
            modal.innerHTML = '';
            modal.appendChild(modalContent);
            modal.style.display = 'block';
        }

        // Remove both duplicate agencies array declarations and use agencyData for all agency-related operations
        function showAgencyModal(agency) {
            const modal = document.getElementById('modal');
            const modalContent = document.createElement('div');
            modalContent.className = 'modal-content';
            
            modalContent.innerHTML = `
                <div class="agency-details">
                    <h2 class="agency-name">${agency.name}</h2>
                    <p class="agency-address">${agency.address}</p>
                    <p class="agency-phone">${agency.phone}</p>
                </div>
                
                <div class="performance-grid">
                    <div class="performance-metric">
                        <div class="metric-value">$${agency.medianLeasePrice}</div>
                        <div class="metric-label">Median Lease Price</div>
                    </div>
                    <div class="performance-metric">
                        <div class="metric-value">${agency.medianDaysAdvertised}</div>
                        <div class="metric-label">Median Days Advertised</div>
                    </div>
                    <div class="performance-metric">
                        <div class="metric-value">${agency.propertiesLeased}</div>
                        <div class="metric-label">Properties Leased</div>
                    </div>
                    <div class="performance-metric">
                        <div class="metric-value">${agency.propertiesForRent}</div>
                        <div class="metric-label">Properties For Rent</div>
                    </div>
                </div>

                <div class="staff-section">
                    ${agency.staff ? `
                        <div class="staff-controls">
                            <h3>Our Team</h3>
                            <div class="staff-filters">
                                <button class="filter-button active" onclick="filterStaff('all')">All Staff</button>
                                <button class="filter-button" onclick="filterStaff('sales')">Sales Agents</button>
                                <button class="filter-button" onclick="filterStaff('property')">Property Managers</button>
                                <button class="filter-button" onclick="filterStaff('bdm')">BDM</button>
                                <button class="filter-button" onclick="filterStaff('leasing')">Leasing</button>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            modal.innerHTML = '';
            modal.appendChild(modalContent);
            modal.style.display = 'block';
        }

        function showAgentRankings() {
            const modal = document.getElementById('staff-modal');
            const modalContent = document.createElement('div');
            modalContent.className = 'staff-modal-content';
            
            modalContent.innerHTML = `
                <div class="rankings-section" style="padding: 30px;">
                    <h2 style="text-align: center; margin-bottom: 30px;">Agent Performance Rankings</h2>
                    
                    <div class="rankings-controls">
                        <div class="metric-buttons" style="justify-content: center;">
                            <button class="metric-button active" onclick="updateRankings('medianSoldPrice')">
                                Median Sold Price
                            </button>
                            <button class="metric-button" onclick="updateRankings('medianDaysAdvertised')">
                                Days Advertised
                            </button>
                            <button class="metric-button" onclick="updateRankings('propertiesSoldLead')">
                                Properties Sold (Lead)
                            </button>
                            <button class="metric-button" onclick="updateRankings('propertiesSoldSecondary')">
                                Properties Sold (Secondary)
                            </button>
                        </div>
                    </div>
                    
                    <div class="rankings-list" id="agentRankingsList">
                        <!-- Rankings will be populated here -->
                    </div>
                    
                    <button onclick="closeStaffModal()" style="display: block; width: 100%; padding: 15px; background: #4c6ef5; color: white; border: none; border-radius: 8px; margin-top: 30px; cursor: pointer;">
                        Close Rankings
                    </button>
                </div>
            `;
            
            modal.innerHTML = '';
            modal.appendChild(modalContent);
            modal.style.display = 'block';
            
            // Initialize with median sold price rankings
            updateRankings('medianSoldPrice');
        }

        function updateRankings(metric) {
            // Update active button state
            const buttons = document.querySelectorAll('.metric-button');
            buttons.forEach(button => button.classList.remove('active'));
            event.target.classList.add('active');

            // Get all agents from the agencies data
            const allAgents = [];
            agencyData.forEach(agency => {
                if (agency.staff) {
                    agency.staff.forEach(agent => {
                        allAgents.push({
                            ...agent,
                            agencyName: agency.name
                        });
                    });
                }
            });

            // Sort agents based on the selected metric
            allAgents.sort((a, b) => {
                if (metric === 'medianDaysAdvertised') {
                    return a[metric] - b[metric]; // Lower is better for days advertised
                }
                return b[metric] - a[metric]; // Higher is better for other metrics
            });

            // Generate the rankings HTML
            const rankingsList = document.getElementById('agentRankingsList');
            rankingsList.innerHTML = '';

            allAgents.forEach((agent, index) => {
                const rankCard = document.createElement('div');
                rankCard.className = 'rank-card';
                rankCard.style.cssText = `
                    display: flex;
                    align-items: center;
                    padding: 15px;
                    margin: 10px 0;
                    background: white;
                    border-radius: 8px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                `;

                const metricValue = metric === 'medianSoldPrice' 
                    ? `$${agent[metric]}k`
                    : agent[metric];

                rankCard.innerHTML = `
                    <div style="font-size: 24px; font-weight: bold; margin-right: 20px; color: #4c6ef5; min-width: 40px;">
                        #${index + 1}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: bold; font-size: 18px;">${agent.name}</div>
                        <div style="color: #666; margin-top: 5px;">${agent.agencyName}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 20px; font-weight: bold; color: #006B3F;">${metricValue}</div>
                        <div style="color: #666; font-size: 14px;">${getMetricLabel(metric)}</div>
                    </div>
                `;

                rankingsList.appendChild(rankCard);
            });
        }

        function getMetricLabel(metric) {
            switch(metric) {
                case 'medianSoldPrice':
                    return 'Median Sold Price';
                case 'medianDaysAdvertised':
                    return 'Days Advertised';
                case 'propertiesSoldLead':
                    return 'Properties Sold (Lead)';
                case 'propertiesSoldSecondary':
                    return 'Properties Sold (Secondary)';
                default:
                    return '';
            }
        }

        function createAgencyCard(agency) {
            const card = document.createElement('div');
            card.className = 'agency-card';
            
            // Add toggle button only for VicProp
            const toggleButton = agency.name === 'VicProp' ? `
                <div class="agency-compare-toggle">
                    <label class="agency-compare-label">
                        <input type="checkbox" onchange="toggleAgencyCompare('${agency.name}', this)" />
                        Compare
                    </label>
                </div>
            ` : '';

            // Add logo for VicProp
            const logoHtml = agency.name === 'VicProp' ? `
                <div class="agency-logo">
                    <img src="/images/agents/Suburbs/Melbourne - 3000/Vicprop/Vicprop logo.jpeg" alt="VicProp Logo" class="agency-logo-image">
                </div>
            ` : '';

            card.innerHTML = `
                ${toggleButton}
                ${logoHtml}
                <h2 class="agency-name">${agency.name}</h2>
                <p class="agency-address"><i class="fas fa-map-marker-alt"></i> ${agency.address}</p>
                <p class="agency-phone"><i class="fas fa-phone"></i> ${agency.phone}</p>
                <div class="agency-staff">
                    <h3>Our Team</h3>
                    <div class="staff-grid">
                        ${agency.staff.map(agent => createAgentCard(agent).outerHTML).join('')}
                    </div>
                </div>
            `;
            
            return card;
        }

        // Add comparison functionality
        let selectedAgents = [];

        function toggleCompare(agentName, checkbox) {
            const compareBar = document.getElementById('compareBar');
            
            if (checkbox.checked) {
                if (selectedAgents.length >= 3) {
                    alert('You can compare up to 3 agents at a time');
                    checkbox.checked = false;
                    return;
                }
                
                const agent = findAgent(agentName);
                if (agent) {
                    selectedAgents.push(agent);
                }
            } else {
                selectedAgents = selectedAgents.filter(a => a.name !== agentName);
            }

            updateCompareBar();
        }

        function findAgent(name) {
            for (const agency of agencies) {
                if (agency.staff) {
                    const agent = agency.staff.find(a => a.name === name);
                    if (agent) return agent;
                }
            }
            return null;
        }

        function updateCompareBar() {
            const compareBar = document.getElementById('compareBar');
            const selectedAgentsDiv = document.querySelector('.selected-agents');

            if (selectedAgents.length > 0) {
                compareBar.style.display = 'flex';
                selectedAgentsDiv.innerHTML = selectedAgents.map(agent => `
                    <div class="selected-agent">
                        <img src="${agent.photo}" alt="${agent.name}" onerror="this.src='/images/placeholder.jpg'">
                        <span>${agent.name}</span>
                        <span class="remove-agent" onclick="removeAgent('${agent.name}')">&times;</span>
                    </div>
                `).join('');
            } else {
                compareBar.style.display = 'none';
            }
        }

        function removeAgent(agentName) {
            const checkbox = document.querySelector(`input[type="checkbox"][onchange*="${agentName}"]`);
            if (checkbox) checkbox.checked = false;
            
            selectedAgents = selectedAgents.filter(a => a.name !== agentName);
            updateCompareBar();
        }

        function clearComparison() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"][onchange*="toggleCompare"]');
            checkboxes.forEach(cb => cb.checked = false);
            
            selectedAgents = [];
            updateCompareBar();
            hideComparisonModal();
        }

        function showComparison() {
            const modal = document.getElementById('comparisonModal');
            const content = document.querySelector('.comparison-content');
            const comparisonGrid = content.querySelector('.comparison-grid');
            const metricComparison = content.querySelector('.metric-comparison');

            // Update agent comparison grid
            comparisonGrid.innerHTML = selectedAgents.map(agent => `
                <div class="agent-comparison">
                    <img src="${agent.photo}" alt="${agent.name}" class="agent-profile-image" onerror="this.src='/images/placeholder.jpg'">
                    <h3>${agent.name}</h3>
                    <p>${agent.position}</p>
                </div>
            `).join('');

            // Update metric comparison
            metricComparison.innerHTML = `
                <div class="metric-row">
                    <div class="metric-label">Median Sold Price</div>
                    ${selectedAgents.map(agent => `
                        <div class="metric-value price">$${agent.performance?.medianSoldPrice || 'N/A'}k</div>
                    `).join('')}
                </div>
                <div class="metric-row">
                    <div class="metric-label">Median Days Advertised</div>
                    ${selectedAgents.map(agent => `
                        <div class="metric-value days">${agent.performance?.medianDaysAdvertised || 'N/A'}</div>
                    `).join('')}
                </div>
                <div class="metric-row">
                    <div class="metric-label">Properties Sold (Lead)</div>
                    ${selectedAgents.map(agent => `
                        <div class="metric-value properties">${agent.performance?.propertiesSoldLead || 'N/A'}</div>
                    `).join('')}
                </div>
                <div class="metric-row">
                    <div class="metric-label">Properties Sold (Secondary)</div>
                    ${selectedAgents.map(agent => `
                        <div class="metric-value properties">${agent.performance?.propertiesSoldSecondary || 'N/A'}</div>
                    `).join('')}
                </div>
            `;

            modal.style.display = 'block';
        }

        function hideComparisonModal() {
            const modal = document.getElementById('comparisonModal');
            modal.style.display = 'none';
        }

        function showAgencyProfile(agency) {
            const modal = document.getElementById('staff-modal');
            const backdrop = document.getElementById('modal-backdrop');
            
            // Create the modal content
            const modalContent = document.createElement('div');
            modalContent.className = 'staff-modal-content';
            
            // Add agency header
            modalContent.innerHTML = `
                <span class="close-modal" onclick="hideStaffModal()">&times;</span>
                <h2>${agency.name}</h2>
                <div class="agency-info">
                    <p><i class="fas fa-map-marker-alt"></i> ${agency.address}</p>
                    <p><i class="fas fa-phone"></i> ${agency.phone}</p>
                </div>
                
                <div class="staff-section">
                    <h3>Our Team</h3>
                    <div class="staff-grid">
                        ${agency.staff.map(agent => createAgentCard(agent).outerHTML).join('')}
                    </div>
                </div>

                <div class="comparison-section">
                    <h3>Compare Agents</h3>
                    <div class="comparison-filters">
                        <div class="filter-group">
                            <label>Sort by:</label>
                            <button class="filter-button" onclick="sortAgentsInModal('medianSoldPrice')">
                                Median Sold Price
                                <span class="sort-icon">↕</span>
                            </button>
                            <button class="filter-button" onclick="sortAgentsInModal('medianDaysAdvertised')">
                                Days Advertised
                                <span class="sort-icon">↕</span>
                            </button>
                            <button class="filter-button" onclick="sortAgentsInModal('propertiesSoldLead')">
                                Properties Sold (Lead)
                                <span class="sort-icon">↕</span>
                            </button>
                            <button class="filter-button" onclick="sortAgentsInModal('propertiesSoldSecondary')">
                                Properties Sold (Secondary)
                                <span class="sort-icon">↕</span>
                            </button>
                        </div>
                    </div>
                    <div class="comparison-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Agent</th>
                                    <th>Median Sold Price</th>
                                    <th>Days Advertised</th>
                                    <th>Properties Sold (Lead)</th>
                                    <th>Properties Sold (Secondary)</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${agency.staff.map(agent => `
                                    <tr>
                                        <td>
                                            <div class="agent-cell">
                                                <img src="${agent.photo}" alt="${agent.name}" onerror="this.src='/images/placeholder.jpg'">
                                                <div>
                                                    <div class="agent-name">${agent.name}</div>
                                                    <div class="agent-position">${agent.position}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="price">$${agent.performance?.medianSoldPrice || 'N/A'}k</td>
                                        <td class="days">${agent.performance?.medianDaysAdvertised || 'N/A'}</td>
                                        <td class="properties">${agent.performance?.propertiesSoldLead || 'N/A'}</td>
                                        <td class="properties">${agent.performance?.propertiesSoldSecondary || 'N/A'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            modal.appendChild(modalContent);
            backdrop.style.display = 'block';
            modal.style.display = 'block';
        }

        // Add styles for the comparison table
        const style = document.createElement('style');
        style.textContent = `
            .comparison-section {
                margin-top: 40px;
                padding-top: 20px;
                border-top: 1px solid #eee;
            }

            .comparison-filters {
                margin-bottom: 20px;
            }

            .filter-group {
                display: flex;
                gap: 10px;
                align-items: center;
                flex-wrap: wrap;
            }

            .filter-button {
                padding: 8px 16px;
                border: 1px solid #4c6ef5;
                border-radius: 20px;
                background: transparent;
                color: #4c6ef5;
                cursor: pointer;
                font-size: 14px;
                transition: all 0.2s ease;
                display: flex;
                align-items: center;
                gap: 5px;
            }

            .filter-button:hover {
                background: rgba(76, 110, 245, 0.1);
            }

            .filter-button.active {
                background: #4c6ef5;
                color: white;
            }

            .sort-icon {
                font-size: 12px;
            }

            .sort-icon.asc {
                transform: rotate(180deg);
            }

            .comparison-table {
                overflow-x: auto;
                margin-top: 20px;
            }

            .comparison-table table {
                width: 100%;
                border-collapse: collapse;
                background: white;
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }

            .comparison-table th,
            .comparison-table td {
                padding: 15px;
                text-align: left;
                border-bottom: 1px solid #eee;
            }

            .comparison-table th {
                background: #f8f9fa;
                font-weight: 600;
                color: #333;
            }

            .comparison-table tr:last-child td {
                border-bottom: none;
            }

            .agent-cell {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .agent-cell img {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                object-fit: cover;
            }

            .agent-name {
                font-weight: 500;
                color: #333;
            }

            .agent-position {
                font-size: 12px;
                color: #666;
            }

            .price {
                color: #4c6ef5;
                font-weight: 500;
            }

            .days {
                color: #2f9e44;
                font-weight: 500;
            }

            .properties {
                color: #e03131;
                font-weight: 500;
            }

            .comparison-table tr:hover {
                background: #f8f9fa;
            }
        `;
        document.head.appendChild(style);

        function hideAgencyComparisonModal() {
            const modal = document.getElementById('agencyComparisonModal');
            modal.style.display = 'none';
        }

        // Add agency comparison functionality
        let selectedAgencies = [];

        function toggleAgencyCompare(agencyName, checkbox) {
            const compareBar = document.getElementById('agencyCompareBar');
            
            if (checkbox.checked) {
                if (selectedAgencies.length >= 3) {
                    alert('You can compare up to 3 agencies at a time');
                    checkbox.checked = false;
                    return;
                }
                
                const agency = findAgency(agencyName);
                if (agency) {
                    selectedAgencies.push(agency);
                }
            } else {
                selectedAgencies = selectedAgencies.filter(a => a.name !== agencyName);
            }

            updateAgencyCompareBar();
        }

        function findAgency(name) {
            return agencies.find(a => a.name === name);
        }

        function updateAgencyCompareBar() {
            const compareBar = document.getElementById('agencyCompareBar');
            const selectedAgenciesDiv = document.querySelector('.selected-agencies');

            if (selectedAgencies.length > 0) {
                compareBar.style.display = 'flex';
                selectedAgenciesDiv.innerHTML = selectedAgencies.map(agency => `
                    <div class="selected-agency">
                        <span>${agency.name}</span>
                        <span class="remove-agency" onclick="removeAgency('${agency.name}')">&times;</span>
                    </div>
                `).join('');
            } else {
                compareBar.style.display = 'none';
            }
        }

        function removeAgency(agencyName) {
            const checkbox = document.querySelector(`input[type="checkbox"][onchange*="${agencyName}"]`);
            if (checkbox) checkbox.checked = false;
            
            selectedAgencies = selectedAgencies.filter(a => a.name !== agencyName);
            updateAgencyCompareBar();
        }

        function clearAgencyComparison() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"][onchange*="toggleAgencyCompare"]');
            checkboxes.forEach(cb => cb.checked = false);
            
            selectedAgencies = [];
            updateAgencyCompareBar();
            hideAgencyComparisonModal();
        }

        function showAgencyComparison() {
            const modal = document.getElementById('agencyComparisonModal');
            const content = document.querySelector('.agency-comparison-content');
            const comparisonGrid = content.querySelector('.agency-comparison-grid');
            const metricComparison = content.querySelector('.agency-metric-comparison');

            // Update agency comparison grid
            comparisonGrid.innerHTML = selectedAgencies.map(agency => `
                <div class="agency-comparison-card">
                    <h3>${agency.name}</h3>
                    <p>${agency.address}</p>
                    <p>${agency.phone}</p>
                </div>
            `).join('');

            // Calculate average metrics for each agency
            const agencyMetrics = selectedAgencies.map(agency => {
                const salesAgents = agency.staff.filter(agent => 
                    agent.position.toLowerCase().includes('sales') || 
                    agent.position.toLowerCase().includes('principal') || 
                    agent.position.toLowerCase().includes('director')
                );

                const metrics = {
                    medianSoldPrice: 0,
                    medianDaysAdvertised: 0,
                    propertiesSoldLead: 0,
                    propertiesSoldSecondary: 0
                };

                if (salesAgents.length > 0) {
                    metrics.medianSoldPrice = salesAgents.reduce((sum, agent) => 
                        sum + (agent.performance?.medianSoldPrice || 0), 0) / salesAgents.length;
                    metrics.medianDaysAdvertised = salesAgents.reduce((sum, agent) => 
                        sum + (agent.performance?.medianDaysAdvertised || 0), 0) / salesAgents.length;
                    metrics.propertiesSoldLead = salesAgents.reduce((sum, agent) => 
                        sum + (agent.performance?.propertiesSoldLead || 0), 0) / salesAgents.length;
                    metrics.propertiesSoldSecondary = salesAgents.reduce((sum, agent) => 
                        sum + (agent.performance?.propertiesSoldSecondary || 0), 0) / salesAgents.length;
                }

                return metrics;
            });

            // Update metric comparison
            metricComparison.innerHTML = `
                <div class="agency-metric-row">
                    <div class="agency-metric-label">Average Median Sold Price</div>
                    ${agencyMetrics.map(metrics => `
                        <div class="agency-metric-value price">$${Math.round(metrics.medianSoldPrice)}k</div>
                    `).join('')}
                </div>
                <div class="agency-metric-row">
                    <div class="agency-metric-label">Average Days Advertised</div>
                    ${agencyMetrics.map(metrics => `
                        <div class="agency-metric-value days">${Math.round(metrics.medianDaysAdvertised)}</div>
                    `).join('')}
                </div>
                <div class="agency-metric-row">
                    <div class="agency-metric-label">Average Properties Sold (Lead)</div>
                    ${agencyMetrics.map(metrics => `
                        <div class="agency-metric-value properties">${Math.round(metrics.propertiesSoldLead)}</div>
                    `).join('')}
                </div>
                <div class="agency-metric-row">
                    <div class="agency-metric-label">Average Properties Sold (Secondary)</div>
                    ${agencyMetrics.map(metrics => `
                        <div class="agency-metric-value properties">${Math.round(metrics.propertiesSoldSecondary)}</div>
                    `).join('')}
                </div>
            `;

            modal.style.display = 'block';
        }

        function createAgentCard(agent) {
            const card = document.createElement('div');
            card.className = 'staff-member';
            card.setAttribute('onclick', `showStaffModal(${JSON.stringify(agent)})`);
            
            card.innerHTML = `
                <div class="agent-compare-toggle">
                    <label class="agent-compare-label">
                        <input type="checkbox" onchange="toggleCompare('${agent.name}', this); event.stopPropagation();" />
                        <span>Compare</span>
                    </label>
                </div>
                <img src="${agent.photo}" alt="${agent.name}" class="staff-photo" onerror="this.src='/images/placeholder.jpg'">
                <h3 class="staff-name">${agent.name}</h3>
                <p class="staff-position">${agent.position}</p>
                <p class="staff-phone">${agent.phone}</p>
            `;
            
            return card;
        }
    </script>
</body>
</html>